DefinitionString:
 Fn::Sub: |
 {
  "Comment": "Step to Submit request to Algorithm API",
  "StartAt": "SubmitRequest",
  "States": {
    "SubmitRequest": {
      "Type": "Task",
      "Resource": "${SubmitRequest.arn}",
      "Next": "CheckProcessRequestStatus"
    },
    "CheckProcessRequestStatus": {
      "Type": "Choice",
      "Choices": [
        {
          "Variable":"$.request_status",
          "StringEquals":"REQUESTED",
          "Next":"WaitForProcess"
        },
        {
          "Variable":"$.request_status",
          "StringEquals":"FAILED",
          "Next":"PostProcessingStep"
        }
      ],
      "Default":"PostProcessingStep"
    },
    "WaitForProcess":{
      "Type":"Wait",
      "SecondsPath":"$.info.avg_wait_time",
      "Next":"CheckProcessStatus"
    },
    "CheckProcessStatus":{
      "Type":"Task",
      "Resource":"${CheckProcessStatus.arn}",
      "Next":"ChoiceOnProcessStatus"
    },
    "ChoiceOnProcessStatus":{
      "Type":"Choice",
      "Choices":[
        {
          "Variable":"$.process_info.status",
          "StringEquals":"COMPLETED",
          "Next": "PostProcessingStep"
        },
        {
          "Variable":"$.process_info.status",
          "StringEquals":"FAILED",
          "Next": "PostProcessingStep" 
        },
        {
          "Variable":"$.process_info.status",
          "StringEquals":"RUNNING",
          "Next": "WaitForProcess"
        }
      ]
    },
    "PostProcessingStep":{
      "Type": "Task",
      "Resource": "${PostProcessingStep.arn}",
      "End": true
    }
  }
}